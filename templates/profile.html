<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Profile · ChecoType</title>
    <link rel="icon" href="/static/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script>
      document.documentElement.classList.add("dark");
    </script>
    <script>
      (() => {
        const themes = {
          default: {
            bg: "#0b1220",
            surface: "rgba(15, 23, 42, 0.9)",
            surfaceBorder: "#1f2937",
            text: "#f8fafc",
            muted: "#94a3b8",
            word: "#e2e8f0",
            pillBg: "rgba(15, 23, 42, 0.8)",
            pillBorder: "#334155",
            pillText: "#cbd5f5",
            caret: "#fbbf24",
            menuBg: "rgba(15, 23, 42, 0.96)",
            correct: "#076652",
            incorrect: "#f87171",
          },
          ocean: {
            bg: "#071629",
            surface: "rgba(9, 30, 56, 0.9)",
            surfaceBorder: "#1b3655",
            text: "#e6f0ff",
            muted: "#8aa4c6",
            word: "#d8e6ff",
            pillBg: "rgba(8, 26, 46, 0.85)",
            pillBorder: "#2b4a74",
            pillText: "#cfe0ff",
            caret: "#22d3ee",
            menuBg: "rgba(9, 30, 56, 0.96)",
            correct: "#60a5fa",
            incorrect: "#fb7185",
          },
          forest: {
            bg: "#0a1612",
            surface: "rgba(11, 27, 20, 0.9)",
            surfaceBorder: "#1b3a2c",
            text: "#e7f7ef",
            muted: "#8fb9a6",
            word: "#d7efe4",
            pillBg: "rgba(11, 27, 20, 0.85)",
            pillBorder: "#2b5a45",
            pillText: "#c9f0dc",
            caret: "#86efac",
            menuBg: "rgba(11, 27, 20, 0.96)",
            correct: "#34d399",
            incorrect: "#f97316",
          },
          amber: {
            bg: "#1b1404",
            surface: "rgba(36, 26, 6, 0.9)",
            surfaceBorder: "#5c3d09",
            text: "#fff7e6",
            muted: "#c9a467",
            word: "#ffedc2",
            pillBg: "rgba(36, 26, 6, 0.85)",
            pillBorder: "#7a5414",
            pillText: "#ffdf9e",
            caret: "#fbbf24",
            menuBg: "rgba(36, 26, 6, 0.96)",
            correct: "#facc15",
            incorrect: "#ef4444",
          },
          sakura: {
            bg: "#1a1017",
            surface: "rgba(30, 18, 27, 0.92)",
            surfaceBorder: "#4a2a3b",
            text: "#fbe9f1",
            muted: "#c9a1b3",
            word: "#f8d8e6",
            pillBg: "rgba(30, 18, 27, 0.85)",
            pillBorder: "#6a3d55",
            pillText: "#f5c6da",
            caret: "#fb7185",
            menuBg: "rgba(30, 18, 27, 0.96)",
            correct: "#f9a8d4",
            incorrect: "#fb7185",
          },
          lavender: {
            bg: "#14101f",
            surface: "rgba(23, 18, 37, 0.9)",
            surfaceBorder: "#3a2f56",
            text: "#efe9ff",
            muted: "#b3a6d1",
            word: "#e1d8ff",
            pillBg: "rgba(23, 18, 37, 0.85)",
            pillBorder: "#58417e",
            pillText: "#d6c8ff",
            caret: "#c4b5fd",
            menuBg: "rgba(23, 18, 37, 0.96)",
            correct: "#a78bfa",
            incorrect: "#f87171",
          },
          arctic: {
            bg: "#081a1f",
            surface: "rgba(10, 29, 35, 0.9)",
            surfaceBorder: "#1b4b59",
            text: "#e6fbff",
            muted: "#93c5d1",
            word: "#d2f6ff",
            pillBg: "rgba(10, 29, 35, 0.85)",
            pillBorder: "#2a6071",
            pillText: "#c7f2ff",
            caret: "#7dd3fc",
            menuBg: "rgba(10, 29, 35, 0.96)",
            correct: "#38bdf8",
            incorrect: "#f97316",
          },
          ember: {
            bg: "#1b0c0c",
            surface: "rgba(32, 12, 12, 0.92)",
            surfaceBorder: "#4b1c1c",
            text: "#ffe9e9",
            muted: "#c78f8f",
            word: "#ffd7d7",
            pillBg: "rgba(32, 12, 12, 0.85)",
            pillBorder: "#6b2c2c",
            pillText: "#ffc2c2",
            caret: "#fb7185",
            menuBg: "rgba(32, 12, 12, 0.96)",
            correct: "#fca5a5",
            incorrect: "#fb7185",
          },
          slate: {
            bg: "#0f131a",
            surface: "rgba(18, 23, 31, 0.9)",
            surfaceBorder: "#2a3644",
            text: "#edf2f7",
            muted: "#9aa8bd",
            word: "#e2e8f0",
            pillBg: "rgba(18, 23, 31, 0.85)",
            pillBorder: "#3b4a5f",
            pillText: "#d6e1f2",
            caret: "#cbd5e1",
            menuBg: "rgba(18, 23, 31, 0.96)",
            correct: "#93c5fd",
            incorrect: "#f87171",
          },
          mint: {
            bg: "#0a1515",
            surface: "rgba(10, 24, 24, 0.9)",
            surfaceBorder: "#1e3d3d",
            text: "#e6fff9",
            muted: "#89bfb5",
            word: "#d4fff3",
            pillBg: "rgba(10, 24, 24, 0.85)",
            pillBorder: "#2c5a5a",
            pillText: "#c6fff0",
            caret: "#5eead4",
            menuBg: "rgba(10, 24, 24, 0.96)",
            correct: "#2dd4bf",
            incorrect: "#fb7185",
          },
        };
        const stored = localStorage.getItem("typing-color-theme") || "default";
        const theme = themes[stored] || themes.default;
        const root = document.documentElement;
        Object.entries(theme).forEach(([key, value]) => {
          root.style.setProperty(`--app-${key}`, value);
        });
      })();
    </script>
    <script>
      window.tailwind = { config: { darkMode: "class" } };
      tailwind = window.tailwind;
    </script>
    <style>
      body {
        font-family: "Space Grotesk", ui-sans-serif, system-ui, -apple-system, "Segoe UI", sans-serif;
      }
      html {
        background-color: #ffffff;
      }
      html.dark {
        background-color: #0b1220;
      }
      html.dark body {
        color: #f8fafc;
      }
      html.dark .surface {
        background-color: rgba(15, 23, 42, 0.9);
        border-color: #1f2937;
      }
      html.dark .surface-input {
        background-color: rgba(2, 6, 23, 0.6);
        border-color: #334155;
        color: #f8fafc;
      }
      :root {
        --app-bg: #0b1220;
        --app-surface: rgba(15, 23, 42, 0.9);
        --app-surface-border: #1f2937;
        --app-text: #f8fafc;
        --app-muted: #94a3b8;
        --app-word: #e2e8f0;
        --app-pill-bg: rgba(15, 23, 42, 0.8);
        --app-pill-border: #334155;
        --app-pill-text: #cbd5f5;
        --app-caret: #fbbf24;
        --app-menu-bg: rgba(15, 23, 42, 0.96);
        --app-correct: #076652;
        --app-incorrect: #f87171;
      }
      html,
      body {
        background-color: var(--app-bg) !important;
        color: var(--app-text);
      }
      .surface {
        background-color: var(--app-surface) !important;
        border-color: var(--app-surface-border) !important;
      }
      .surface-input {
        background-color: color-mix(in srgb, var(--app-surface) 85%, #000) !important;
        border-color: var(--app-surface-border) !important;
        color: var(--app-text) !important;
      }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-transparent text-slate-900 dark:text-white">
    <main class="mx-auto flex min-h-screen w-full max-w-5xl flex-col gap-10 px-8 py-12">
      <header class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <p class="text-xs uppercase tracking-[0.3em] text-slate-400 dark:text-slate-500">Your profile</p>
          <h1 class="mt-3 text-4xl font-semibold tracking-tight">@{{ current_user.username or "set-username" }}</h1>
        </div>
        <div class="flex items-center gap-3">
          <a href="{{ url_for('index') }}" class="rounded-full border border-slate-300 px-4 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-300 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800">Back to test</a>
          <a href="{{ url_for('logout') }}" class="rounded-full border border-transparent px-4 py-2 text-xs font-semibold text-slate-600 hover:text-slate-900 dark:text-slate-300 dark:hover:text-white">Log out</a>
        </div>
      </header>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700 dark:border-emerald-900/60 dark:bg-emerald-950/30 dark:text-emerald-200">
            {{ messages[0] }}
          </div>
        {% endif %}
      {% endwith %}

      {% if not current_user.username %}
        <div class="rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-700 dark:border-amber-900/60 dark:bg-amber-950/30 dark:text-amber-200">
          Set a username to finish onboarding and unlock progress tracking.
        </div>
      {% endif %}

      <section class="surface rounded-3xl border border-slate-200 bg-slate-100/90 p-8 shadow-sm dark:border-slate-800 dark:bg-slate-900">
        <h2 class="text-lg font-semibold">Profile settings</h2>
        <form method="post" class="mt-4 flex flex-wrap items-end gap-4">
          <label class="flex flex-col gap-2 text-sm font-medium text-slate-600 dark:text-slate-300">
            Username
            <input name="username" type="text" required value="{{ current_user.username or '' }}" class="surface-input w-64 rounded-xl border border-slate-300 bg-slate-300 px-4 py-3 text-base text-slate-900 focus:border-slate-500 focus:outline-none dark:border-slate-700 dark:bg-slate-950/60 dark:text-white dark:focus:border-slate-400" />
          </label>
          <button type="submit" name="update_username" value="1" class="rounded-full bg-slate-900 px-6 py-3 text-sm font-semibold text-white shadow hover:bg-slate-800 dark:bg-slate-200 dark:text-slate-950 dark:hover:bg-white">Update</button>
        </form>
      </section>

      <section class="surface rounded-3xl border border-slate-200 bg-slate-100/90 p-8 shadow-sm dark:border-slate-800 dark:bg-slate-900">
        <h2 class="text-lg font-semibold">Reset password</h2>
        <form method="post" class="mt-4 grid gap-4 md:grid-cols-3">
          {% if current_user.password_hash %}
            <label class="flex flex-col gap-2 text-sm font-medium text-slate-600 dark:text-slate-300">
              Current password
              <input name="current_password" type="password" required class="surface-input rounded-xl border border-slate-300 bg-slate-300 px-4 py-3 text-base text-slate-900 focus:border-slate-500 focus:outline-none dark:border-slate-700 dark:bg-slate-950/60 dark:text-white dark:focus:border-slate-400" />
            </label>
          {% else %}
            <div class="rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-700 dark:border-amber-900/60 dark:bg-amber-950/30 dark:text-amber-200 md:col-span-3">
              You signed up with Google. Set a password to enable email sign-in.
            </div>
          {% endif %}
          <label class="flex flex-col gap-2 text-sm font-medium text-slate-600 dark:text-slate-300">
            New password
            <input name="new_password" type="password" required class="surface-input rounded-xl border border-slate-300 bg-slate-300 px-4 py-3 text-base text-slate-900 focus:border-slate-500 focus:outline-none dark:border-slate-700 dark:bg-slate-950/60 dark:text-white dark:focus:border-slate-400" />
          </label>
          <label class="flex flex-col gap-2 text-sm font-medium text-slate-600 dark:text-slate-300">
            Confirm new password
            <input name="confirm_password" type="password" required class="surface-input rounded-xl border border-slate-300 bg-slate-300 px-4 py-3 text-base text-slate-900 focus:border-slate-500 focus:outline-none dark:border-slate-700 dark:bg-slate-950/60 dark:text-white dark:focus:border-slate-400" />
          </label>
          <div class="flex items-end">
            <button type="submit" name="update_password" value="1" class="w-full rounded-full bg-slate-900 px-6 py-3 text-sm font-semibold text-white shadow hover:bg-slate-800 dark:bg-slate-200 dark:text-slate-950 dark:hover:bg-white">Update password</button>
          </div>
        </form>
      </section>

      <section class="grid gap-5 md:grid-cols-6">
        <div class="surface rounded-2xl border border-slate-200 bg-slate-100/90 p-5 dark:border-slate-800 dark:bg-slate-900">
          <p class="text-[11px] uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Fastest WPM</p>
          <p class="mt-2 text-3xl font-semibold">{{ summary.fastest_wpm }}</p>
        </div>
        <div class="surface rounded-2xl border border-slate-200 bg-slate-100/90 p-5 dark:border-slate-800 dark:bg-slate-900">
          <p class="text-[11px] uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Fastest Raw WPM</p>
          <p class="mt-2 text-3xl font-semibold">{{ summary.fastest_raw_wpm }}</p>
        </div>
        <div class="surface rounded-2xl border border-slate-200 bg-slate-100/90 p-5 dark:border-slate-800 dark:bg-slate-900">
          <p class="text-[11px] uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Avg WPM</p>
          <p class="mt-2 text-3xl font-semibold">{{ summary.avg_wpm }}</p>
        </div>
        <div class="surface rounded-2xl border border-slate-200 bg-slate-100/90 p-5 dark:border-slate-800 dark:bg-slate-900">
          <p class="text-[11px] uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Avg Accuracy</p>
          <p class="mt-2 text-3xl font-semibold">{{ summary.avg_accuracy }}%</p>
        </div>
        <div class="surface rounded-2xl border border-slate-200 bg-slate-100/90 p-5 dark:border-slate-800 dark:bg-slate-900">
          <p class="text-[11px] uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Best Accuracy</p>
          <p class="mt-2 text-3xl font-semibold">{{ summary.best_accuracy }}%</p>
        </div>
        <div class="surface rounded-2xl border border-slate-200 bg-slate-100/90 p-5 dark:border-slate-800 dark:bg-slate-900">
          <p class="text-[11px] uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Streak</p>
          <p class="mt-2 text-3xl font-semibold">{{ summary.current_streak }} <span class="text-base font-medium text-slate-500">/ {{ summary.longest_streak }}</span></p>
        </div>
      </section>

      <section class="surface rounded-3xl border border-slate-200 bg-slate-100/90 p-8 shadow-sm dark:border-slate-800 dark:bg-slate-900">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div>
            <h2 class="text-lg font-semibold">Recent tests</h2>
            <p class="mt-1 text-xs uppercase tracking-[0.25em] text-slate-400 dark:text-slate-500">Latest 30</p>
          </div>
          <div class="flex flex-wrap items-center gap-3 text-xs text-slate-500 dark:text-slate-400">
            <span class="uppercase tracking-[0.25em]">Records</span>
            <span class="rounded-full border border-slate-200 bg-white/80 px-3 py-1 font-semibold text-slate-700 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-200">Fastest Raw {{ summary.fastest_raw_wpm }}</span>
            <span class="uppercase tracking-[0.25em]">Characters</span>
            <span class="rounded-full border border-slate-200 bg-white/80 px-3 py-1 font-semibold text-slate-700 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-200">Correct {{ summary.correct_chars }}</span>
            <span class="rounded-full border border-slate-200 bg-white/80 px-3 py-1 font-semibold text-slate-700 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-200">Incorrect {{ summary.incorrect_chars }}</span>
            <span class="rounded-full border border-slate-200 bg-white/80 px-3 py-1 font-semibold text-slate-700 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-200">Extra {{ summary.extra_chars }}</span>
            <span class="rounded-full border border-slate-200 bg-white/80 px-3 py-1 font-semibold text-slate-700 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-200">Missed {{ summary.missed_chars }}</span>
          </div>
        </div>
        {% if results %}
          <div class="mt-4 overflow-x-auto">
            <table class="w-full min-w-[740px] text-left text-sm">
              <thead class="text-xs uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">
                <tr>
                  <th class="py-3">Date</th>
                  <th class="py-3">WPM</th>
                  <th class="py-3">Raw WPM</th>
                  <th class="py-3">Accuracy</th>
                  <th class="py-3">Duration</th>
                  <th class="py-3">Chars</th>
                  <th class="py-3">Lang</th>
                  <th class="py-3">Caps</th>
                  <th class="py-3">Accents</th>
                  <th class="py-3">Punct</th>
                  <th class="py-3">Hard</th>
                </tr>
              </thead>
              <tbody class="text-slate-600 dark:text-slate-300">
                {% for result in results %}
                  <tr class="border-t border-slate-200 dark:border-slate-800">
                    <td class="py-3">{{ format_dt(result.created_at) }}</td>
                    <td class="py-3 font-semibold text-slate-900 dark:text-white">{{ result.wpm }}</td>
                    <td class="py-3">{{ result.raw_wpm }}</td>
                    <td class="py-3">{{ result.accuracy }}%</td>
                    <td class="py-3">{{ result.duration_seconds }}s</td>
                    <td class="py-3">{{ result.char_count }}</td>
                    <td class="py-3">{{ result.language|upper if result.language else "—" }}</td>
                    <td class="py-3">
                      {% if result.caps_enabled is not none %}
                        {{ "On" if result.caps_enabled else "Off" }}
                      {% else %}
                        —
                      {% endif %}
                    </td>
                    <td class="py-3">
                      {% if result.accents_enabled is not none %}
                        {{ "On" if result.accents_enabled else "Off" }}
                      {% else %}
                        —
                      {% endif %}
                    </td>
                    <td class="py-3">
                      {% if result.punctuation_enabled is not none %}
                        {{ "On" if result.punctuation_enabled else "Off" }}
                      {% else %}
                        —
                      {% endif %}
                    </td>
                    <td class="py-3">
                      {% if result.hard_mode_enabled is not none %}
                        {{ "On" if result.hard_mode_enabled else "Off" }}
                      {% else %}
                        —
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="mt-4 text-sm text-slate-500 dark:text-slate-400">No results yet. Finish a test to start tracking progress.</p>
        {% endif %}
      </section>
    </main>
    <script>
      (() => {
        const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
        if (!tz) {
          return;
        }
        fetch("/api/timezone", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ timezone: tz }),
        }).catch(() => {});
      })();
    </script>
  </body>
</html>
